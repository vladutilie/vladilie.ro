---
title: 'BibliotecÄƒ EuPlÄƒtesc pentru Node.js'
locale: ro
featuredImage: https://res.cloudinary.com/vladilie-ro/image/upload/v1702310627/blog/kbebi7eftqq6buvgxneu.webp
blurDataImage: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAvElEQVR4nGOICA+aO3f2kkULb924efLYyVOnzty8cefchYtPHz95+vgJg6qKopiogLSklIWp2Y4tO/bvP3jzxp31m7Zcv3b91o2bDIGBgVFRUeXl5VOmTGlsbGxrrL9+7fr8+fNXrlz5//9/kLS9vf2+ffv+w8CJEydyc3O3bNly4sQJhvb6mhvXrsDlINIvX76cPXvBmTMXGc6fPL564SI06RMnTkANP7h3N5r09WvXV65c+eXLl////wMArFCaHaOpA1kAAAAASUVORK5CYII=
description: Cum am dezvoltat un modul pentru Node.js al unui serviciu de platÄƒ online cu o documentaÈ›ie È™i un API slab scrise. ğŸ‘
type: Post
keywords: [euplatesc,nodejs,integrare,javascript,api,gateway]
date: October 6, 2022 20:00:00
---

Nu de puÈ›ine ori mi-a fost dat sÄƒ integrez API-ul de la serviciul de plÄƒÈ›i online <a href="https://euplatesc.ro" target="_blank" className="after:content-['_â†—']">EuPlÄƒtesc</a> Ã®n proiectele pe care le-am Ã®ntreprins.
De obicei, Ã®n rÃ¢ndul proiectelor pentru clienÈ›ii din RomÃ¢nia, EuPlÄƒtesc a fost printre primele servicii pe care le-am recomandat clienÈ›ilor atunci cÃ¢nd le-am propus astfel de soluÈ›ii.
È˜i aÈ™a am tot cochetat cu API-ul lor, pÃ¢nÄƒ cÃ¢nd am creat aceastÄƒ bibliotecÄƒ pentru Node.js pentru a-mi uÈ™ura mie munca, Ã®n primul rÃ¢nd, È™i apoi pentru a oferi Ã®napoi un plus valoare, sper eu, comunitÄƒÈ›ii de programatori din RomÃ¢nia.

## Intro

Pentru cei ce nu È™tiu, documentaÈ›ia È™i API-ul Ã®n sine de la EuPlÄƒtesc nu respectÄƒ vreun standard.
FÄƒrÄƒ a fi rÄƒu, atÃ¢t documentaÈ›ia cÃ¢t È™i API-ul Ã®n sine, din pÄƒcate, par sÄƒ fi fost scrise de un elev de liceu care È™i-a dat atestatul la informaticÄƒ.
Dar sÄƒ trecem peste asta, tot rÄƒul spre bine, acum existÄƒ biblioteca `euplatesc` pentru Node.js publicatÄƒ pe <a href="https://www.npmjs.com/package/euplatesc" taget="_blank">npmjs.com</a> È™i pe <a href="https://github.com/vladutilie/euplatesc/pkgs/npm/euplatesc" target="_blank">Github Packages</a> ğŸ‰.

Astfel, â€dupÄƒ lupte seculare, care au durat aproape...â€, am reuÈ™it sÄƒ implementez Ã®n bibliotecÄƒ API-ul EuPlÄƒtesc Ã®n Ã®ntregime È™i este È™i documentatÄƒ pe mÄƒsurÄƒ.
BineÃ®nÈ›eles sunt aÈ™teptate cu drag È™i cÃ¢teva teste È™i eventual raportÄƒri de probleme din partea celor care o folosesc.

## Generare legÄƒturÄƒ de iniÈ›iere de platÄƒ recurentÄƒ

Hai sÄƒ Ã®ncercÄƒm È™i un exemplu de utilizare, mai exact voi folosi biblioteca pentru a genera o legÄƒturÄƒ de platÄƒ recurentÄƒ.

### 1. IniÈ›iere proiect

Voi Ã®ncepe prin a crea un director nou pentru proiectul meu:

```sh
$ cd ~/www
$ mkdir euplatesc-recurrent-payment
$ cd euplatesc-recurrent-payment
```

IniÈ›iez proiectul È™i instalez pachetul `euplatesc`:

```sh
$ npm init -y
$ npm install euplatesc
```

sau dacÄƒ foloseÈ™ti `yarn`:

```sh
$ yarn init -y
$ yarn add euplatesc
```

### 2. InstanÈ›iere EuPlÄƒtesc

È˜i voi crea fiÈ™ierul index.js unde voi instanÈ›ia un obiect EuPlÄƒtesc:

```js showLineNumbers title="index.js"
const { EuPlatesc } = require('euplatesc');

const epClient = new EuPlatesc({
  merchantId: '123456',
  secretKey: '987654',
  testMode: true
});
```

DupÄƒ cum se observÄƒ, am setat instanÈ›a mea Ã®n modul test.
Asta Ã®nseamnÄƒ cÄƒ nu am neapÄƒrat nevoie de `merchantId` È™i `secretKey` reale, ne vom juca mai departe cu datele de test (care vor fi setate automat de bibliotecÄƒ ğŸ™ŒğŸ¼), iar pentru a genera doar o legÄƒturÄƒ de platÄƒ nu avem nevoie de un cont real.

### 3. Definire parametri metodÄƒ `paymentUrl`

Mai departe voi defini o constantÄƒ de parametri pe care o voi transmite mai departe metodei de generare legÄƒturÄƒ de platÄƒ:

```js showLineNumbers title="index.js" {9-12}
const date = new Date();
const nextYear = new Date(date.setFullYear(date.getFullYear() + 1));

const data = {
  amount: 1,
  currency: 'RON',
  invoiceId: '00016',
  // dacÄƒ foloseÈ™ti diacritice Ã®n orderDescription, vei avea surprize ğŸ
  orderDescription: 'Campanie de donatii pentru BookTruck',
  frequency: {
    days: 30,
    expiresAt: nextYear
  }
};
```

De notat faptul cÄƒ aceastÄƒ platÄƒ va fi una recurentÄƒ, automatÄƒ la 30 de zile pÃ¢nÄƒ Ã®n anul viitor cÃ¢nd va expira, aÈ™a cum am setat Ã®n liniile 9-12.

ğŸ Glumesc, dar algoritmii de calculare a semnÄƒturii nu se Ã®nÈ›eleg cu diacriticele ğŸ¤·ğŸ»â€â™‚ï¸ È™i vei vedea Ã®n locul paginii de platÄƒ un mesaj de genul:

```txt
Incorrect signature.
Redirecting...
Array ( [Ammount] => 1.00 [Currency] => RON [InvoiceID] => 00016 [OrderDesc] => Campanie de donaÈ›ii pentru BookTruck [MerchantID] => testaccount [TranTimeStamp] => 20221006200725 [Nonce] => 6987594dfe4e62e6217b46f4e7eaa02e [RECUR_FREQ] => 30 [RECUR_EXP] => 20231006 )
B332D594566571A72EE06B7DC3A04528
```

### 4. Apelare metodÄƒ `paymentUrl`

Ãn final apelez metoda `paymentUrl` Ã®ntr-un bloc `try-catch`\* È™i voi obÈ›ine legÄƒtura de platÄƒ cÄƒtre platforma euplatesc.ro (vezi comentariul de la linia 4):

```js showLineNumbers title="index.js" {4}
try {
  const { paymentUrl } = ep.paymentUrl(data);
  console.log(paymentUrl);
  // https://secure.euplatesc.ro/tdsprocess/tranzactd.php?amount=1.00&curr=RON&invoice_id=00016&order_desc=Campanie+de+donatii+pentru+BookTruck&merch_id=testaccount&timestamp=20221006200159&nonce=0da1459243140a81821c9749c1f960f9&recurent_freq=30&recurent_exp=20231006&fp_hash=6375E870C7760ACB7B7DD06A7DD1FFED&recurent=Base
} catch (e) {
  console.error(e);
}
```

Astfel am generat o legÄƒturÄƒ care va conduce utilizatorul pe pagina de platÄƒ euplatesc.ro unde va continua plata cu cardul.

\* Este posibil ca dacÄƒ te joci cu parametri sÄƒ primeÈ™ti anumite excepÈ›ii sau Ã®n pagina de platÄƒ sÄƒ aparÄƒ un mesaj de eroare.
ÃÈ›i recomand sÄƒ urmÄƒreÈ™ti cu atenÈ›ie <a href='https://www.npmjs.com/package/euplatesc' target='_blank'>documentaÈ›ia bibliotecii</a> sau dacÄƒ vrei sÄƒ te Ã®ncumeÈ›i, chiar È™i pe cea oferitÄƒ de EuPlÄƒtesc din panoul lor de control.

### Tot codul

Cuprins Ã®n 28 de linii:

```js showLineNumbers title="index.js"
const { EuPlatesc } = require('euplatesc');

const ep = new EuPlatesc({
  merchantId: '123456',
  secretKey: '987654',
  testMode: true
});

const date = new Date();
const nextYear = new Date(date.setFullYear(date.getFullYear() + 1));

const data = {
  amount: 1,
  currency: 'RON',
  invoiceId: '00016',
  orderDescription: 'Campanie de donatii pentru BookTruck',
  frequency: {
    days: 30,
    expiresAt: nextYear
  }
};

try {
  const { paymentUrl } = ep.paymentUrl(data);
  console.log(paymentUrl);
} catch (e) {
  console.error(e);
}
```

## Concluzii

Prin dezvoltarea acestei biblioteci mi-am uÈ™urat munca È™i tare sper cÄƒ nu doar mie È™i de-acum Ã®n colo voi evita, Ã®n proiectele viitoare, toatÄƒ nebunia de calcule de semnÄƒturi, verificÄƒri de hash-uri, cÃ¢mpuri care trebuie sÄƒ vinÄƒ neapÄƒrat dupÄƒ alte cÃ¢mpuri Ã®ntr-un obiect, etc.
CunoscÄƒtorii È™tiu despre ce vorbesc.

Am luat Ã®n vizor È™i alte servicii care nu au dezvoltate biblioteci pentru Node.js È™i pe care mi-ar plÄƒcea sÄƒ le dezvolt. Aici intrÄƒ LibraPay, Oblio, poate serviciile de curierat.
